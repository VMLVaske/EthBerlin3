import Head from 'next/head'
import Layout from '../components/layout'
import { Container, Row, Text, Spacer, Divider, Col, Grid, Button } from '@nextui-org/react';


import type { NextPage } from 'next';
import { useAddress } from '@thirdweb-dev/react';

const Home: NextPage = () => {

  const address = useAddress();

  const promisify = require('es6-promisify')
  const TruffleContract = require('@truffle/contract')
  const Web3 = require('web3')
  const { Deployer } = require('@wearekickback/contracts')

  const deploy = async () => {

    const web3 = new Web3(Web3.givenProvider)

    const contract = TruffleContract(Deployer)
    contract.setProvider(web3.currentProvider)

    const deployer = await contract.deployed()

    // deploy a new party (see Deployer.sol for parameter documentation)
    await deployer.deploy('My event', 0, 10, 1, address)

    const events = await promisify(deployer.contract.getPastEvents, deployer.contract)('NewParty')

    const { returnValues: { deployedAddress } } = events.pop()

    console.log(`New party contract deployed at: ${deployedAddress}`)
  }

  return (
    <Layout>
      <div >
        <Head>
          <title>Test Next App</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <main>
          <Container fluid md gap={3}>
            <Spacer />
            <Row justify="center">
              <Text h1>Main Page</Text>
              <Spacer />
            </Row>
            <Spacer />
            <Divider />
            <Spacer />
            <Row>
              <Text h3>Create Event</Text>
            </Row>
            <Row>
              <Button onPress={deploy}>Create a new Event</Button>
            </Row>
          </Container>
        </main>
      </div>
    </Layout>
  )
}


export default Home;